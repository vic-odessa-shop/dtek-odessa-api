<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ú–æ–π –°–≤–µ—Ç (–û–¥–µ—Å—Å–∞)</title>
    <style>
        body { font-family: sans-serif; background: #f0f2f5; padding: 15px; margin: 0; }
        .card { background: white; padding: 15px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); margin-bottom: 15px; }
        input { width: 100%; padding: 12px; margin: 8px 0; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; }
        button { width: 100%; padding: 12px; background: #007bff; color: white; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; }
        .addr-title { font-weight: bold; display: flex; justify-content: space-between; }
        .delete { color: #ff4d4d; cursor: pointer; font-size: 0.8em; }
        .res-box { margin-top: 10px; padding: 10px; border-radius: 8px; background: #f8f9fa; }
        .btn-direct { display: block; width: 100%; padding: 12px; background: #28a745; color: white; text-align: center; text-decoration: none; border-radius: 8px; font-weight: bold; border: none; }
    </style>
</head>
<body>

    <div class="card">
        <h3>–î–æ–±–∞–≤–∏—Ç—å –∞–¥—Ä–µ—Å</h3>
        <input type="text" id="st" placeholder="–£–ª–∏—Ü–∞ (–õ—é—Å—Ç–¥–æ—Ä—Ñ—Å—å–∫–∞ –¥–æ—Ä–æ–≥–∞)">
        <input type="text" id="hs" placeholder="–î–æ–º (189)">
        <button onclick="add()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∞–¥—Ä–µ—Å</button>
    </div>

    <div id="list"></div>

    <script>
        const API_URL = "https://dtek-odessa.onrender.com";
        let addresses = JSON.parse(localStorage.getItem('dtek_multi_v4')) || [];

        function render() {
            const listDiv = document.getElementById('list');
            listDiv.innerHTML = addresses.map((addr, i) => `
                <div class="card">
                    <div class="addr-title">
                        üìç ${addr.s}, ${addr.h}
                        <span class="delete" onclick="remove(${i})">–£–¥–∞–ª–∏—Ç—å</span>
                    </div>
                    <div id="res-${i}" class="res-box">
                        <button onclick="check(${i}, '${addr.s}', '${addr.h}')">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å</button>
                    </div>
                </div>
            `).join('');
        }

        async function check(i, s, h) {
            const box = document.getElementById(`res-${i}`);
            box.innerHTML = "‚åõ –ü—ã—Ç–∞—é—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –Ω–∞–ø—Ä—è–º—É—é...";

            try {
                const response = await fetch(`${API_URL}/check?street=${encodeURIComponent(s)}&house=${encodeURIComponent(h)}`);
                const result = await response.json();

                if (result.status === 'success') {
                    box.innerHTML = result.html; // –ï—Å–ª–∏ Render –≤–¥—Ä—É–≥ —Å—Ä–∞–±–æ—Ç–∞–ª
                } else {
                    showDirectButton(box, s, h); // –ï—Å–ª–∏ Render –æ—Ç–≤–µ—Ç–∏–ª –æ—à–∏–±–∫–æ–π
                }
            } catch (e) {
                showDirectButton(box, s, h); // –ï—Å–ª–∏ Render –≤–æ–æ–±—â–µ —É–ø–∞–ª/–∑–∞–±–∞–Ω–µ–Ω
            }
        }

        function showDirectButton(box, s, h) {
            box.innerHTML = `
                <div style="color: #856404; background: #fff3cd; padding: 10px; border-radius: 8px; border: 1px solid #ffeeba; margin-bottom: 10px; font-size: 0.85em;">
                    –î–¢–≠–ö –±–ª–æ–∫–∏—Ä—É–µ—Ç —Å–µ—Ä–≤–µ—Ä. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –¥–ª—è –∞–≤—Ç–æ-–ø–µ—Ä–µ—Ö–æ–¥–∞:
                </div>
                <form action="https://www.dtek-oem.com.ua/ua/shutdowns" method="GET" target="_blank">
                    <input type="hidden" name="query" value="${s} ${h}">
                    <button type="submit" class="btn-direct">üöÄ –ü–ï–†–ï–ô–¢–ò –ö –ì–†–ê–§–ò–ö–£</button>
                </form>
            `;
        }

        function add() {
            const s = document.getElementById('st').value;
            const h = document.getElementById('hs').value;
            if(s && h) {
                addresses.push({ s, h });
                localStorage.setItem('dtek_multi_v4', JSON.stringify(addresses));
                render();
                document.getElementById('st').value = '';
                document.getElementById('hs').value = '';
            }
        }

        function remove(i) {
            addresses.splice(i, 1);
            localStorage.setItem('dtek_multi_v4', JSON.stringify(addresses));
            render();
        }

        render();
    </script>
</body>
</html>
